name: 'Update Repository Files'
description: 'Update multiple files in another repository with new Docker image tags'
author: 'GitHub Actions Workflows'

inputs:
  github-token:
    description: 'GitHub Personal Access Token with repo permissions'
    required: true
  node-version:
    description: 'Node.js version to use'
    required: false
    default: '18'
  docker-registry:
    description: 'Docker registry URL'
    required: true
  image-name:
    description: 'Docker ì´ë¯¸ì§€ ì´ë¦„'
    required: true
  image-tag:
    description: 'Docker ì´ë¯¸ì§€ íƒœê·¸ (ì˜ˆ: v1.0.0, 2025.01.15.1430)'
    required: true
  target-repo:
    description: 'ëŒ€ìƒ ë ˆí¬ì§€í† ë¦¬ (ì˜ˆ: owner/k8s-manifests)'
    required: true
  target-file-paths:
    description: 'ì—…ë°ì´íŠ¸í•  íŒŒì¼ ê²½ë¡œë“¤ (ì½¤ë§ˆë¡œ êµ¬ë¶„, ì˜ˆ: deployment/app.yaml,k8s/configmap.yaml)'
    required: true
  target-branch:
    description: 'ëŒ€ìƒ ë¸Œëœì¹˜ (ë¯¸ì§€ì •ì‹œ ê¸°ë³¸ ë¸Œëœì¹˜ ì‚¬ìš©)'
    required: false
    default: ''
  commit-message:
    description: 'ì»¤ë°‹ ë©”ì‹œì§€'
    required: false
    default: ''

outputs:
  image-tag:
    description: 'ì—…ë°ì´íŠ¸ëœ ì´ë¯¸ì§€ íƒœê·¸'
    value: ${{ steps.update-files.outputs.image-tag }}
  updated-files:
    description: 'ì„±ê³µì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ëœ íŒŒì¼ë“¤ (ì½¤ë§ˆë¡œ êµ¬ë¶„)'
    value: ${{ steps.update-files.outputs.updated-files }}
  failed-files:
    description: 'ì—…ë°ì´íŠ¸ì— ì‹¤íŒ¨í•œ íŒŒì¼ë“¤ (ì½¤ë§ˆë¡œ êµ¬ë¶„)'
    value: ${{ steps.update-files.outputs.failed-files }}
  success-count:
    description: 'ì„±ê³µí•œ íŒŒì¼ ìˆ˜'
    value: ${{ steps.update-files.outputs.success-count }}
  fail-count:
    description: 'ì‹¤íŒ¨í•œ íŒŒì¼ ìˆ˜'
    value: ${{ steps.update-files.outputs.fail-count }}

runs:
  using: 'composite'
  steps:
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: ${{ inputs.node-version }}

    - name: Download repository files update script
      shell: bash
      run: |
        echo "ğŸ“¥ Downloading repository files update script..."
        curl -fsSL -o /tmp/update-repository-files.js https://raw.githubusercontent.com/akfmdl/github-actions-workflows/test/scripts/update-repository-files.js
        chmod +x /tmp/update-repository-files.js
        
    - name: Update repository files
      id: update-files
      shell: bash
      env:
        DOCKER_REGISTRY: ${{ inputs.docker-registry }}
        IMAGE_NAME: ${{ inputs.image-name }}
        IMAGE_TAG: ${{ inputs.image-tag }}
        TARGET_REPO: ${{ inputs.target-repo }}
        TARGET_FILE_PATHS: ${{ inputs.target-file-paths }}
        TARGET_BRANCH: ${{ inputs.target-branch }}
        GITHUB_TOKEN: ${{ inputs.github-token }}
        COMMIT_MESSAGE: ${{ inputs.commit-message }}
        SOURCE_REPOSITORY: ${{ github.repository }}
      run: |
        echo "ğŸš€ ë ˆí¬ì§€í† ë¦¬ íŒŒì¼ë“¤ ì—…ë°ì´íŠ¸ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤..."
        echo "ğŸ“‹ ëŒ€ìƒ íŒŒì¼ë“¤: ${{ inputs.target-file-paths }}"
        node /tmp/update-repository-files.js

    - name: Workflow Complete
      shell: bash
      run: |
        echo "âœ… Repository Files Update workflow completed successfully!"
        echo "ğŸ“Š Summary has been generated with detailed links and information."

branding:
  icon: 'edit'
  color: 'green' 