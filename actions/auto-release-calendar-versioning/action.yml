name: 'Auto Release with Calendar Versioning'
description: 'Automatically create GitHub releases using semantic-release when pushing to specified branches with calendar versioning'
author: 'GitHub Actions Workflows'

inputs:
  token:
    description: 'GitHub í† í° (GITHUB_TOKEN ë˜ëŠ” PAT)'
    required: true
  npm_token:
    description: 'NPM í† í° (NPM íŒ¨í‚¤ì§€ ë°œí–‰ì‹œ í•„ìš”)'
    required: false
  working_directory:
    description: 'ì‘ì—… ë””ë ‰í† ë¦¬'
    required: false
    default: '.'
  dry_run:
    description: 'ë“œë¼ì´ëŸ° ëª¨ë“œ (ì‹¤ì œ ë¦´ë¦¬ì¦ˆí•˜ì§€ ì•ŠìŒ)'
    required: false
    default: 'false'

runs:
  using: 'composite'
  steps:
    - name: Checkout ì½”ë“œ
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
        token: ${{ inputs.token }}

    - name: Node.js ì„¤ì •
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        cache: 'npm'
        cache-dependency-path: ${{ inputs.working_directory }}/package-lock.json

    - name: ì˜ì¡´ì„± ì„¤ì¹˜
      shell: bash
      working-directory: ${{ inputs.working_directory }}
      run: npm ci

    - name: ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ê¶Œí•œ ì„¤ì •
      shell: bash
      working-directory: ${{ inputs.working_directory }}
      run: chmod +x scripts/generate-version.js

    - name: Semantic Release ì‹¤í–‰ (Calendar Versioning)
      shell: bash
      working-directory: ${{ inputs.working_directory }}
      env:
        GITHUB_TOKEN: ${{ inputs.token }}
        NPM_TOKEN: ${{ inputs.npm_token }}
      run: |
        if [ "${{ inputs.dry_run }}" = "true" ]; then
          echo "ğŸ” ë“œë¼ì´ëŸ° ëª¨ë“œë¡œ ì‹¤í–‰ ì¤‘..."
          echo "ğŸ“… Calendar Versioning í˜•ì‹: year.month.minor.fix"
          npx semantic-release --dry-run
        else
          echo "ğŸš€ ë¦´ë¦¬ì¦ˆ ì‹¤í–‰ ì¤‘..."
          echo "ğŸ“… Calendar Versioning í˜•ì‹: year.month.minor.fix"
          npx semantic-release
        fi

branding:
  icon: 'calendar'
  color: 'purple' 